---
title: "멱등성(Idempotency)"
description: "멱등성(Idempotency)의 이해와 API 설계에서의 중요성"
date: 2025-06-03 10:00:00 +0900
categories: [CS, Common]
tags: [Computer Science, Common, Idempotency, API]
---


## ✅ 멱등성(Idempotency)과 API 설계의 원칙

---

### 1. 서론: 멱등성의 개념과 필요성

멱등성(Idempotency)은 같은 작업을 여러 번 수행해도 결과가 달라지지 않는 성질을 의미한다. 이 개념은 수학에서 비롯되었으며, 소프트웨어 개발, 특히 API 설계에서 매우 중요한 원칙으로 작용한다.

웹 환경에서는 네트워크 오류나 사용자 실수로 인해 동일한 요청이 반복해서 발생하는 경우가 많다. 예를 들어, 결제 버튼을 두 번 누르거나, 타임아웃 후 자동 재전송되는 요청 등이 그 사례이다. 이러한 상황에서도 시스템이 안정적으로 동작하려면 API가 멱등성을 보장해야 한다.

멱등성은 단지 기술적인 개념에 그치지 않고, **데이터의 일관성과 시스템의 안정성**을 유지하기 위한 핵심 전략으로 작용한다. 본 글에서는 멱등성의 개념을 구체적으로 설명하고, 이를 API 설계에 적용하는 방법과 실제 사례, 그리고 적용하지 않았을 때 발생하는 문제에 대해 다루고자 한다.

---

### 2. 멱등성이 중요한 이유

HTTP 프로토콜은 각 메서드에 대해 멱등성 여부를 정의하고 있다:

| 메서드    | 멱등성 | 설명                                |
| ------ | --- | --------------------------------- |
| GET    | 있음  | 서버 상태 변경 없이 데이터를 조회함              |
| PUT    | 있음  | 특정 리소스를 동일한 값으로 치환함               |
| DELETE | 있음  | 대상 리소스를 삭제하며, 이미 삭제된 경우에도 결과가 동일함 |
| POST   | 없음  | 새로운 리소스를 생성하므로 중복 요청 시 결과가 달라짐    |
| PATCH  | 부분적 | 수정 방식에 따라 다름                      |

예를 들어, `DELETE /user/123` 요청은 리소스를 삭제하며, 동일 요청을 여러 번 보내더라도 서버 상태는 변하지 않는다. 반면 `POST /orders` 요청은 주문을 생성하므로 중복 요청 시 여러 건의 주문이 생성되는 문제가 발생할 수 있다.

멱등성이 보장되면 클라이언트는 안심하고 재요청을 수행할 수 있으며, 서버도 상태를 안정적으로 유지할 수 있다. 이는 **예측 가능한 API 동작**을 보장하고, 네트워크 오류 상황에서도 **시스템의 신뢰성**을 유지하는 데 기여한다.

---

### 3. API 설계에서 멱등성을 보장하는 방법

#### (1) HTTP 메서드의 의미에 맞게 API를 설계한다

* 조회는 `GET`, 전체 갱신은 `PUT`, 삭제는 `DELETE`, 생성은 `POST`, 부분 수정은 `PATCH`를 사용한다.
* `POST` 사용이 불가피한 경우, 추가적인 방법을 통해 멱등성을 보완해야 한다.

#### (2) `Idempotency-Key`를 사용해 `POST` 요청의 멱등성을 확보한다

중복 요청을 방지하기 위해 클라이언트는 고유한 요청 식별자(`Idempotency-Key`)를 헤더에 포함시켜 전송한다:

```http
POST /payments
X-Idempotency-Key: 7f5c1db9-a7e6-4a12-97c4-1dcf2ad8b290
Content-Type: application/json

{
  "amount": 10000,
  "user_id": 123
}
```

서버는 이 키를 기준으로 이전에 처리된 요청이 있는지 검사하고, 동일한 요청이라면 기존 응답을 재사용함으로써 중복 처리를 방지한다.

#### (3) 데이터베이스 레벨에서 중복 요청을 방지한다

* `UNIQUE` 제약조건을 통해 중복 삽입을 방지한다.
* 트랜잭션을 활용하여 동시성 문제를 해결한다.

예: Django 모델에 고유 키를 저장하여 중복 생성 방지

```python
class Order(models.Model):
    idempotency_key = models.CharField(max_length=64, unique=True)
    ...
```

---

### 4. 멱등성이 없는 API의 문제점과 해결 방안

#### 문제 사례: 중복 주문 발생

```http
POST /orders
{
  "product_id": 101,
  "quantity": 1
}
```

* 사용자가 같은 요청을 두 번 전송하면 주문이 두 번 생성된다.
* 실제로는 한 번만 주문했다고 인식하므로, 고객 불만과 환불 등의 문제가 발생한다.

#### 해결 방안:

* 클라이언트가 `Idempotency-Key`를 제공하고,
* 서버가 해당 키를 기준으로 요청을 캐싱하거나 DB에 기록하여 중복 여부를 판단한다.

또한, 응답에 처리 결과와 함께 고유한 리소스 식별자를 포함시켜 클라이언트가 동일 요청을 구분할 수 있도록 한다.

---

### 5. 결론: 신뢰성 높은 API를 위한 멱등성 설계

멱등성은 API 설계에서 선택 사항이 아니라 필수적인 기준으로 간주되어야 한다. 이를 통해 다음과 같은 효과를 기대할 수 있다:

* 클라이언트는 네트워크 오류나 사용자 실수로 인한 중복 요청에 대응할 수 있다.
* 서버는 불필요한 중복 작업을 줄이고, 자원 사용을 최적화할 수 있다.
* 시스템 전체의 신뢰성과 유지보수성이 향상된다.

따라서, 모든 개발자는 멱등성의 원리를 정확히 이해하고, 이를 실무 프로젝트의 API 설계에 적극 반영해야 한다. 특히, `POST`처럼 기본적으로 멱등성을 가지지 않는 요청에 대해서는 별도의 대책을 마련함으로써 시스템의 예측 가능성과 안정성을 높일 수 있다.

---
REFERENCE  
[멱등성(Idempotency)의 이해와 API 설계에서의 중요성](https://f-lab.kr/insight/understanding-idempotency-in-api-design?gad_source=1&gad_campaignid=22368870602&gbraid=0AAAAACGgUFcs6-78ypimifpWJZITxnqSN&gclid=Cj0KCQjw0LDBBhCnARIsAMpYlAqaSzecANVM3CrwmoxBff9qQeXpZ2iXp6p8X0JtjYy_R9iWbR_RTmoaApClEALw_wcB)